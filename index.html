<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .none {
            display: none !important;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script>

        var socket = {};
        var myId = 'erickwendel' + new Date().getTime();
        function showPressButton(show) {
            var element = document.getElementById("pressBtn")
            if (show) {
                element.classList.remove('none')
                return;
            }
            element.classList.add('none')

        }
        window.connect = function connect() {
            socket.emit("add-user", {
                "username": myId,
            });
        }
        window.press = function run() {
            socket.emit("press", {
                "username": myId,
                "sendDate": new Date()
            });
            showPressButton(false)

        }
        window.sort = function sort() {
            socket.emit("sort");
        }
        window.onload = function () {
            document.getElementById("myId").innerHTML = myId
            // socket = io.connect('http://localhost:3000');
            socket = io.connect('https://originalpotato.herokuapp.com/');

            socket.on('expiration-date', function (data) {
                if (!data) return;
                document.getElementById("expirationDate").innerHTML = '<br> Expires at: ' + new Date(data).toLocaleString()
            })

            socket.on('count-users', function (data) {
                if (!data) return;
                document.getElementById("countUsers").innerHTML = '<br> Count Of Active Users: ' + data.count
            })
            socket.on('sorted-user', function (data) {
                if (!data) return;
                document.getElementById("sortedUser").innerHTML = '<br> Sorted User: ' + data
            })

            socket.on(myId, function (data) {
                var node = document.createElement("li");
                var textnode = document.createTextNode(data);
                node.appendChild(textnode);
                document.getElementById("items").appendChild(node);
                if (data === 'HASFAIL') return;

                document.getElementById("pressBtn").classList.remove('none')

            })

        }
    </script>
</head>

<body>
    <output id="myId">
    </output>
    <output id="countUsers">
    </output>
    <output id="sortedUser">
    </output>
    <br>

    <output id="expirationDate">
    </output>
    <button id="pressBtn" class="none" onclick="press()">PRESS!</button>
    <button id="connect" onclick="connect()">CONNECT!</button>
    <button onclick="sort()">SORT!</button>
    <br>
    <br>
    <br>
    <div id="items">
    </div>

</body>

</html>