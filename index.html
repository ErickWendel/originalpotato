<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Original Potato</title>
    <link rel="icon" href="img/Batata.png" type="image/gif">
    <link rel="stylesheet" href="css/dash.css">
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>

    <script>

        var socket = {};
        var myId = 'erickwendel' + new Date().getTime();
        function showPressButton(show) {
            var element = document.getElementById("pressBtn")
            if (show) {
                element.classList.remove('none')
                return;
            }
            element.classList.add('none')

        }
        window.connect = function connect() {
            socket.emit("add-user", {
                "username": myId,
            });
        }
        window.press = function run() {
            socket.emit("press", {
                "username": myId,
                "sendDate": new Date()
            });
            showPressButton(false)

        }
        window.sort = function sort() {
            socket.emit("sort");
        }
        window.onload = function () {

            var url = 'http://localhost:3000/';
            if (location.href.indexOf(url) !== -1) socket = io.connect(url);
            else socket = io.connect('https://originalpotato.herokuapp.com/');
            socket.on('expiration-date', function (data) {
                if (!data) return;
                document.getElementById("expirationDate").innerHTML = '<br> Expira em: ' + new Date(data).toLocaleString()
            })

            socket.on('count-users', function (data) {
                if (!data) return;

                document.getElementById("countUsers").innerHTML = '<br> Existem ' + data.count + ' pessoas conectadas'
                $('#items li').remove()
                data.users.map(item => {
                    $('#items').append('<li class="list-group-item"><span class="thumb"></span><b>' + item + '</b></li>');
                })
            })
            socket.on('sorted-user', function (data) {
                if (!data) return;
                document.getElementById("sortedUser").innerHTML = '<br> Usu√°rio sorteado: ' + data
            })

            socket.on(myId, function (data) {
                var node = document.createElement("li");
                var textnode = document.createTextNode(data);
                node.appendChild(textnode);
                document.getElementById("items").appendChild(node);
                if (data === 'HASFAIL') return;

                document.getElementById("pressBtn").classList.remove('none')

            })

        }
    </script>
</head>

<body>
    <div class="container">
        <div class="col-sm-12 navbar navbar-default">
            <img src="./img/Batata.png" alt="" class="logo">
            <h1>Original Potato</h1>
        </div>
        <div class="wrapper">
            <div class="col-sm-6 block-author">
                <h2>Erick Wendel</h2>
                <img class="person-img img-responsive" src="http://usbhacker.herokuapp.com/erick.jpg" alt="">
                <ul class="list-default">
                    <li>
                        erickwendel.com.br
                    </li>
                    <li>
                        github.com/erickwendel
                    </li>
                    <li>
                        fb.com/page.erickwendel
                    </li>

                </ul>
            </div>
            <div class="col-sm-6 block-author">
                <h2>Cesar Oliveira</h2>
                <img class="person-img img-responsive" src="https://media.licdn.com/mpr/mpr/shrinknp_400_400/AAIAAgDGAAAAAQAAAAAAAA3LAAAAJGIyYmFlNTg2LWZjYmQtNGViZS04YTE1LTE5Yjk4YWIwYjdkZA.jpg"
                    alt="">
                <ul class="list-default">
                    <li>
                        github.com/cesarolvr
                    </li>
                    <li>
                        linkedin.com/in/cesarolvr/
                    </li>
                    <li>
                        facebook.com/cesarolvra
                    </li>

                </ul>
            </div>
        </div>


        <div class="header">
            <div class="wrapper">
                <output id="countUsers" class="qdt">
                </output>
                <output id="sortedUser" class="current">
                </output>
            </div>
            <button id="connect" onclick="connect()">Conectar</button>
            <button onclick="sort()">Sortear</button>
            <button id="pressBtn" class="none" onclick="press()">Passar batata</button>
            <br>
            <div class="col-sm-6 col-sm-offset-3">
                <ul id="items" class="list-default">
                </ul>
            </div>
        </div>


    </div>

</body>

</html>