<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="css/dash.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
    <script>

        var socket = {};
        var myId = 'erickwendel' + new Date().getTime();
        function showPressButton(show) {
            var element = document.getElementById("pressBtn")
            if (show) {
                element.classList.remove('none')
                return;
            }
            element.classList.add('none')

        }
        window.connect = function connect() {
            socket.emit("add-user", {
                "username": myId,
            });
        }
        window.press = function run() {
            socket.emit("press", {
                "username": myId,
                "sendDate": new Date()
            });
            showPressButton(false)

        }
        window.sort = function sort() {
            socket.emit("sort");
        }
        window.onload = function () {
            document.getElementById("myId").innerHTML = myId

            var url = 'http://localhost:3000/';
            if (location.href.indexOf(url) !== -1) socket = io.connect(url);
            else socket = io.connect('https://originalpotato.herokuapp.com/');
            debugger
            socket.on('expiration-date', function (data) {
                if (!data) return;
                document.getElementById("expirationDate").innerHTML = '<br> Expira em: ' + new Date(data).toLocaleString()
            })

            socket.on('count-users', function (data) {
                if (!data) return;
                document.getElementById("countUsers").innerHTML = '<br> Usuário ativos: ' + data.count
            })
            socket.on('sorted-user', function (data) {
                if (!data) return;
                document.getElementById("sortedUser").innerHTML = '<br> Usuário sorteado: ' + data
            })

            socket.on(myId, function (data) {
                var node = document.createElement("li");
                var textnode = document.createTextNode(data);
                node.appendChild(textnode);
                document.getElementById("items").appendChild(node);
                if (data === 'HASFAIL') return;

                document.getElementById("pressBtn").classList.remove('none')

            })

        }
    </script>
</head>

<body>
    <div class="header">
        <output id="myId" class="logado">
        </output>
        <output id="countUsers" class="qdt">
        </output>
        <output id="sortedUser" class="current">
        </output>
    </div>



    <output id="expirationDate">
    </output>
    <button id="pressBtn" class="none" onclick="press()">Passar batata</button>
    <button id="connect" onclick="connect()">Conectar</button>
    <button onclick="sort()">Sortear</button>
    <br>
    <br>
    <br>
    <ul id="items" class="list-default">
        <li>Cesar</li>
        <li>João</li>
    </ul>

</body>

</html>